<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="author"
      content="Ondřej Kotan"
    />
    <title>Přihlásit se</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <meta name="theme-color" content="#712cf9" />
    <script src="/scripts/hlavicky.js"></script>
    <script>
      function tryLogin() {
        fetch("/api/ucet/prihlasit-se", {
          method: "POST",
          body: JSON.stringify({
            email: document.getElementById("email").value, 
            password: document.getElementById("password").value
          })})
          .then((response) => {
            if (response.ok) {
              response.json().then((json) => {
                window.cookieStore.set("token", json.token);
                let redirect = new URL(window.location).searchParams.get("redirect");
                if (redirect == null) { redirect = "https://2mgchd.qzz.io/"; }
                window.location = redirect;
              });
            } else {
              response.json().then((json) => {document.getElementById("error").innerText = json.error;})
            }
          })
        .catch(() => { document.getElementById("error").innerText = 
              "Chyba při odesílání požadavku (zkontrolujte připojení k internetu)"; });
      }
    </script>
  </head>
  <body class="bg-body-tertiary">
    <div class="align-items-center d-flex mx-auto vh-100" style="max-width: fit-content;">
        <form style="max-width: 300px">
            <p class="fs-3 py-2 align-middle">Přihlaste se</p>
            <div class="form-floating">
                <input
                    type="email"
                    class="form-control"
                    id="email"
                    style="margin-bottom: -1px; border-bottom-right-radius: 0; border-bottom-left-radius: 0;"
                />
                <label for="email">E-mailová adresa</label>
            </div>
            <div class="form-floating">
                <input
                    type="password"
                    class="form-control"
                    id="password"
                    style="border-top-left-radius: 0; border-top-right-radius: 0;"
                />
                <label for="password">Heslo</label>
            </div>
            <p class="text-danger" id="error"></p>
            <a class="fs-6" href="zapomenute-heslo">Zapomenuté heslo</a>
            <button type="button" class="btn btn-primary w-100 mt-1" onclick="tryLogin()">Přihlásit se</button>
        </form>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      class="astro-vvvwv3sm"
    ></script>
  </body>
</html>